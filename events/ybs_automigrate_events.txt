namespace = ybs_automigrate
event = {
	id = ybs_automigrate.0
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		every_country = {
			limit = {
				is_ai = no
			}
			country_event = {
				id = ybs_automigrate.1
				days = 7
			}
			country_event = {
				id = ybs_automigrate.3
				days = 9
			}
		}
	}
}

event = {
	# Migrate unemployed organics to planets with jobs.
	id = ybs_automigrate.1
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		every_owned_planet = {
			limit = {
				count_owned_pop = {
					limit = {
						is_unemployed = yes
						is_being_purged = no
						# Must not be a robot
						is_robot_pop = no
					}
					count > 0
				}
				# Don't try to migrate off planets under attack
				has_orbital_bombardment = no
			}
			log = "Yagisan - Checking Organic Unemployment for [ROOT.GetName] on [This.Planet.GetName]"
			every_owned_pop = {
				limit = {
					is_unemployed = yes
					is_being_purged = no
					# Ignore assimilating pops
					NOT = {
						has_citizenship_type = {
							type = citizenship_assimilation
						}
					}
					# minimum of 1K energy to move pops
					owner = {
						has_country_resource = {
							type = energy
							amount > 1000
						}
					}
					# Must be allowed to migrate
					has_migration_control = {
						type = no
					}
					# Must not be a robot
					is_robot_pop = no
					# Must not be the last pop
					planet = {
						count_owned_pop = {
							count > 1
						}
					}
				}
				#log = "Yagisan - Found Unemployed [This.GetName] on [PREV.GetName]"
				log = "Yagisan - Found Unemployed [This.GetName]"
				if = {
					limit = {
						# minimum of 1K energy to move pops
						owner = {
							has_country_resource = {
								type = energy
								amount > 1000
							}
						}
					}
					# PREV is the pop
					# PREVPREV is planet it is from
					PREVPREV = {
						ybs_automigrate_unemployed = yes
					}
				}
			}
		}
	}
}

event = {
	# Migrate unemployed robots to planets with jobs.
	id = ybs_automigrate.3
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		every_owned_planet = {
			limit = {
				count_owned_pop = {
					limit = {
						is_unemployed = yes
						is_being_purged = no
						# Must be a robot
						is_robot_pop = yes
					}
					count > 0
				}
				# Don't try to migrate off planets under attack
				has_orbital_bombardment = no
			}
			log = "Yagisan - Checking Robotic Unemployment for [ROOT.GetName] on [This.Planet.GetName]"
			every_owned_pop = {
				limit = {
					is_unemployed = yes
					is_being_purged = no
					# Ignore assimilating pops
					NOT = {
						has_citizenship_type = {
							type = citizenship_assimilation
						}
					}
					# minimum of 1K energy to move pops
					owner = {
						has_country_resource = {
							type = energy
							amount > 1000
						}
					}
					# Must be allowed to migrate
					OR = {
						has_migration_control = {
							type = no
						}
						# Or be a Robot
						is_robot_pop = yes
					}
					# Must not be the last pop
					planet = {
						count_owned_pop = {
							count > 1
						}
					}
				}
				#log = "Yagisan - Found Unemployed [This.GetName] on [PREV.GetName]"
				log = "Yagisan - Found Unemployed [This.GetName]"
				if = {
					limit = {
						# minimum of 1K energy to move pops
						owner = {
							has_country_resource = {
								type = energy
								amount > 1000
							}
						}
					}
					# PREV is the pop
					# PREVPREV is planet it is from
					PREVPREV = {
						ybs_automigrate_unemployed = yes
					}
				}
			}
		}
	}
}
